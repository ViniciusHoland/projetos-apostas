<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Jogos do Dia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
      #bilhete {
        max-height: 400px;
        overflow-y: auto;
      }
      .odd-btn {
        cursor: pointer;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <a href="/" class="btn btn-primary btn-lg px-4">Cadastrar</a>
      <a href="/apostas" class="btn btn-success btn-lg px-4"><i class="fas fa-futbol"></i> Apostas</a>
      <a href="/apostas/caixa" class="btn btn-warning text-dark"><i class="fas fa-box"></i> Caixa</a>

      <h1 class="mb-4">Jogos do Dia</h1>

      <div class="row">
        <div class="col-md-8">
          <% if (Object.keys(campeonatos).length === 0) { %>
            <div class="alert alert-info">Nenhum jogo cadastrado para hoje.</div>
          <% } else { %>
            <% for (let campeonato in campeonatos) { %>
              <h4 class="mt-4"><%= campeonato %></h4>
              <div class="table-responsive">
                <table class="table table-bordered bg-white">
                  <thead>
                    <tr>
                      <th>Horário</th>
                      <th>Times</th>
                      <th>Casa</th>
                      <th>Empate</th>
                      <th>Fora</th>
                      <th>Personalizadas</th>
                      <th>Ações</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% campeonatos[campeonato].forEach(jogo => {
                      const nomeJogo = jogo.timeCasa + " x " + jogo.timeFora;
                      const campeonatoLimpo = campeonato.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
                      const dataHoraFormatada = jogo.dataHora;
                      const dataHoraISO = jogo.dataHora;
                    %>
                      <tr>
                        <td><%= dataHoraFormatada %></td>
                        <td><%= nomeJogo %></td>
                        <td>
                          <button class="btn btn-outline-primary btn-sm odd-btn" onclick='adicionarBilhete("<%= jogo._id %>", "<%= nomeJogo %>", "Casa", <%= jogo.oddCasa %>, "<%= campeonatoLimpo %>", "<%= dataHoraISO %>")'><%= jogo.oddCasa.toFixed(2) %></button>
                        </td>
                        <td>
                          <button class="btn btn-outline-primary btn-sm odd-btn" onclick='adicionarBilhete("<%= jogo._id %>", "<%= nomeJogo %>", "Empate", <%= jogo.oddEmpate %>, "<%= campeonatoLimpo %>", "<%= dataHoraISO %>")'><%= jogo.oddEmpate.toFixed(2) %></button>
                        </td>
                        <td>
                          <button class="btn btn-outline-primary btn-sm odd-btn" onclick='adicionarBilhete("<%= jogo._id %>", "<%= nomeJogo %>", "Fora", <%= jogo.oddFora %>, "<%= campeonatoLimpo %>", "<%= dataHoraISO %>")'><%= jogo.oddFora.toFixed(2) %></button>
                        </td>
                        <td>
                         <% if (!jogo.oddsPersonalizadas || jogo.oddsPersonalizadas.length === 0) { %>

                            -
                          <% } else { %>
                            <ul class="mb-0">
                              <% jogo.oddsPersonalizadas.forEach(o => {
                                const descLimpa = o.descricao.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
                              %>
                                <li>
                                  <button class="btn btn-outline-primary btn-sm odd-btn" onclick='adicionarBilhete("<%= jogo._id %>", "<%= nomeJogo %>", "<%= descLimpa %>", <%= o.valor %>, "<%= campeonatoLimpo %>", "<%= dataHoraISO %>")'>
                                    <strong><%= o.descricao %></strong>: <%= Number(o.valor).toFixed(2) %>
                                  </button>
                                </li>
                              <% }) %>
                            </ul>
                          <% } %>
                        </td>
                        <td class="text-center">
                          <a href="/jogos/editar/<%= jogo._id %>" class="btn btn-warning btn-sm me-1">Editar</a>
                          <button class="btn btn-danger btn-sm" onclick="excluirJogo('<%= jogo._id %>')">Excluir</button>
                        </td>
                      </tr>
                    <% }) %>
                  </tbody>
                </table>
              </div>
            <% } %>
          <% } %>
        </div>

        <div class="col-md-4">
          <h4>Bilhete</h4>
          <div id="bilhete" class="bg-white border p-3 rounded mb-3">
            <p class="text-muted">Nenhuma odd selecionada.</p>
          </div>

          <label for="valorTotal" class="form-label">Valor Total da Aposta (R$):</label>
          <input type="number" id="valorTotal" min="0" step="0.01" class="form-control mb-2" oninput="atualizarRetorno()" />

          <p><strong>Retorno Estimado: R$ <span id="retornoEstimado">0.00</span></strong></p>

          <label for="nomeCliente" class="form-label">Nome do Cliente:</label>
          <input type="text" id="nomeCliente" class="form-control mb-2" />

          <button id="btnFinalizar" class="btn btn-success mt-3" disabled onclick="finalizarAposta()">Finalizar Aposta</button>
        </div>
      </div>
    </div>

    <script src="/js/bilhete.js"></script>
  </body>
</html>
